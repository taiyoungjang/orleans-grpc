
syntax = "proto3";

import "google/protobuf/empty.proto";
import "google/protobuf/duration.proto";  
import "google/protobuf/timestamp.proto";

option csharp_namespace = "game";

package playerNetwork;

service PlayerNetwork {
  rpc GetAuth(AuthRequest) returns (AuthResponse);
  rpc GetRegionPlayerDataList(google.protobuf.Empty) returns (PlayerDataList);
  rpc LoginPlayerData(RegionData) returns (PlayerData);
  rpc CreatePlayer(CreatePlayerRequest) returns (CreatePlayerResponse);
  rpc UpdateStage(UpdateStageRequest) returns(UpdateStageResponse);
  rpc ServerStreamServerEvents (google.protobuf.Empty) returns (stream StreamServerEventsResponse);
  rpc Chat(ChatRequest) returns (ChatResponse);
  rpc GetTopRankList(google.protobuf.Empty) returns (RankList);
}

enum ErrorCode {
    Success = 0;
    Failure = 1;
    AlreadyCreatedCharacter = 2;
    AlreadyDefinedName = 3;
}

message UUID{
  bytes value = 1;
}

message RegionData{
    int64 regionIndex = 1;
}

message PlayerData{
    int64 regionIndex = 1;
    string name = 2;
    int32 stage = 3;
}

message RankData{
    int64 regionIndex = 1;
    int64 rank = 2;
    string name = 3;
    int32 stage = 4;
    google.protobuf.Timestamp updateDate = 5;
}

message RankList{
    google.protobuf.Timestamp updateDate = 1;
    repeated RankData ranks = 2;
}

message ChatRoom{
  int32 regionIndex = 1;
}

message PlayerDataList{
  repeated PlayerData playerDataList = 1;
}

message RoomList{
  repeated ChatRoom chatRooms = 1;
}

message AuthRequest{
  string firebaseId = 1;
  UUID otp = 2;
}
message AuthResponse{
  UUID otp = 1;
  ErrorCode errorCode = 2;
}

message UpdateStageRequest{
  int32 stage = 1;
}

message UpdateStageResponse{
  ErrorCode errorCode = 1;
}

message CreatePlayerRequest{
  int64 regionIndex= 1;
  string name = 2;
}
message CreatePlayerResponse{
  ErrorCode errorCode = 1;
}


message ChatRequest{
  string message = 1;
}
message ChatResponse{
  ErrorCode errorCode = 1;
}

message StreamServerEventsResponse {
  message OnChat{
    int64 regionIndex = 1;
    string otherPlayer = 2;
    string message = 3;
  }
  message OnClosed{
    string reason = 1;
  }
  oneof action {
    OnChat onChat = 1;
    OnClosed onClosed = 2;
  }
}

